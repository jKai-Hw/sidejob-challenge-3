---
description: Figma MCP連携ルール
globs: "**/*"
alwaysApply: true
---

# Figma MCP連携ガイドライン

> このファイルはテンプレートです。Figma MCPを使ってデザインを実装する際のルールです。

## 前提
- デザインは別のデザイナーさんが作成
- 自分はコーディング担当
- Figmaデザインは変更しない（参照のみ）

---

## ⚡ API使用量の最適化（重要）

### 基本方針
- **必要なときだけ取得**: 同じ情報を何度も取得しない
- **キャッシュを活用**: 取得した情報はメモに残す
- **効率的な指示**: AIへの指示を明確にし、やり直しを減らす

### Figma API 最適化ルール

#### 1. 取得タイミングの最小化
```
❌ 避けるべき: セクションごとに毎回ページ全体を取得
✅ 推奨: 最初に1回だけ全体を取得 → 情報をメモ → セクション実装時はメモを参照
```

#### 2. 取得情報のキャッシュ（メモ）
最初にFigmaから取得したら、以下をメモとして残す：

```markdown
## デザインメモ（API取得結果）

### カラーパレット
- Primary: #3B82F6
- Secondary: #10B981
- Text: #1F2937
- Background: #FFFFFF

### フォント
- 見出し: Noto Sans JP / Bold / 32px（PC）, 24px（SP）
- 本文: Noto Sans JP / Regular / 16px / line-height: 1.75

### スペーシング
- セクション間: 80px（PC）, 48px（SP）
- 要素間: 24px

### セクション構成
1. Header
2. Hero（メインビジュアル）
3. About（会社概要）
4. Service（サービス一覧）
5. News（お知らせ）
6. Contact（CTA）
7. Footer
```

#### 3. セクション実装時のルール
```
✅ 正しい流れ:
1. 「ヒーローセクションを実装します」
2. メモを参照してカラー・フォント・余白を使用
3. 必要な場合のみ「この部分の詳細が必要なのでFigmaを確認します」

❌ 避ける流れ:
1. 「ヒーローセクションを実装します」
2. 毎回Figmaから全体を取得し直す
```

### Cursor AI 最適化ルール

#### 1. 明確な指示を出す
```
❌ 曖昧: 「いい感じにして」「きれいにして」
✅ 明確: 「ヒーローセクションのSCSSを作成。変数は_variables.scssを使用」
```

#### 2. 必要なコンテキストだけ渡す
```
❌ 不要: プロジェクト全体のファイルを毎回読み込む
✅ 効率的: 関連ファイルだけを指定（例: _variables.scss, _mixins.scss）
```

#### 3. 出力形式を指定
```
❌ 長い: 「説明も含めて詳しく」→ トークン消費大
✅ 簡潔: 「コードのみ出力」「変更点のみ説明」
```

#### 4. バッチ処理
```
❌ 非効率: 1ファイルずつ順番に依頼
✅ 効率的: 「以下の3ファイルを作成してください」とまとめて依頼
```

### 効率的なワークフロー例

```
【初回のみ】
1. FigmaのページURL全体を渡す
2. AIがデザイン情報を取得
3. デザインメモを作成（カラー、フォント、構成など）
4. _variables.scss, theme.json を作成

【セクション実装時】
1. 「ヒーローセクションを実装」
2. メモとルールを参照してコード生成（API取得なし）
3. 不明点があれば「Figmaで○○を確認して」と明示的に依頼

【確認時のみ】
- 「Figmaと見比べて差異を確認して」
- 必要な箇所だけピンポイントで取得
```

---

## ワークフロー

### Step 1: 全体構造の把握（API取得: 1回）
ページ全体のFigma URLを受け取ったら：
1. MCPでデザイン情報を取得 ← **この1回のみ**
2. セクション構成をリストアップ → **メモに記録**
3. 共通コンポーネントを洗い出し → **メモに記録**
4. デザイントークン（カラー、フォント、余白）を抽出 → **メモに記録**

### Step 2: ベース構築（API取得: 不要）
1. SCSS変数ファイル（_variables.scss）を作成 ← メモを参照
2. theme.jsonにWordPress用設定を反映 ← メモを参照
3. 共通コンポーネントのSCSSを作成 ← メモを参照

### Step 3: セクション実装（API取得: 必要な場合のみ）
セクションごとに：
1. HTMLマークアップ作成（patterns/）← メモ + ルール参照
2. SCSSでスタイリング ← 変数ファイル参照
3. 必要に応じてjQueryでインタラクション
4. レスポンシブ確認
5. **詳細が不明な場合のみ**Figmaを再確認

---

## FigmaデザインURLの扱い方
- Figmaのフレーム/コンポーネントのURLを受け取ったら、MCPを通じてデザイン情報を取得
- デザインの構造、色、フォント、余白などを正確に読み取る
- 不明点があれば実装前に確認を促す
- **取得した情報は必ずメモに残し、再取得を避ける**

---

## デザイントークンの変換

### カラー → SCSS変数 + theme.json
```scss
// _variables.scss
$color-primary: #3B82F6;    // Figmaから抽出
$color-secondary: #10B981;
```

```json
// theme.json
{
  "settings": {
    "color": {
      "palette": [
        { "slug": "primary", "color": "#3B82F6", "name": "Primary" },
        { "slug": "secondary", "color": "#10B981", "name": "Secondary" }
      ]
    }
  }
}
```

### タイポグラフィ → SCSS変数 + theme.json
```scss
// _variables.scss
$font-family-base: 'Noto Sans JP', sans-serif;
$font-size-base: 1rem;      // 16px
$font-size-lg: 1.25rem;     // 20px
$line-height-base: 1.75;
```

```json
// theme.json
{
  "settings": {
    "typography": {
      "fontFamilies": [
        { "fontFamily": "'Noto Sans JP', sans-serif", "slug": "body", "name": "Body" }
      ],
      "fontSizes": [
        { "slug": "medium", "size": "1rem", "name": "Medium" },
        { "slug": "large", "size": "1.25rem", "name": "Large" }
      ]
    }
  }
}
```

### スペーシング → SCSS変数 + theme.json
```scss
// _variables.scss
$spacing-sm: 1rem;    // 16px
$spacing-md: 1.5rem;  // 24px
$spacing-lg: 2rem;    // 32px
```

```json
// theme.json
{
  "settings": {
    "spacing": {
      "spacingSizes": [
        { "slug": "20", "size": "1rem", "name": "Small" },
        { "slug": "30", "size": "1.5rem", "name": "Medium" },
        { "slug": "40", "size": "2rem", "name": "Large" }
      ]
    }
  }
}
```

---

## 実装優先順位
1. デザイントークン抽出・変数定義
2. グローバルスタイル（theme.json + _base.scss）
3. ヘッダー/フッター（parts/）
4. 共通コンポーネント（components/）
5. セクション/パターン（patterns/）
6. 個別テンプレート（templates/）

---

## 品質チェックリスト
- [ ] Figmaデザインとの色の一致
- [ ] フォントサイズ・行間の一致
- [ ] 余白・マージンの一致
- [ ] レスポンシブ対応（SP / タブレット / PC）
- [ ] アクセシビリティ対応（alt、aria-label等）
- [ ] ホバー・フォーカス状態の実装
- [ ] アニメーション・トランジションの実装（指定があれば）

---

## デザイナーへの確認が必要なケース
以下の場合は、実装前にユーザーに確認を促す：
- デザインに曖昧な部分がある
- レスポンシブ時の挙動が不明
- ホバー状態のデザインがない
- 実装上の都合でデザインの調整が必要
