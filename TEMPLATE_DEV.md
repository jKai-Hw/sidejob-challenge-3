# 🛠️ テンプレート開発メモ

> **このファイルについて**
>
> このファイルは**テンプレート開発用**のメモです。
> **developブランチにのみ存在**し、mainにはマージしません。
> 案件でコピーした時には含まれません。

---

## 📋 テンプレートの目的

- Figma → WordPress のコーディング案件を効率化するためのテンプレート
- Cursor（AI）との協業ルールを整備
- 外注やクライアントに回しやすい形を目指す

---

## 📜 開発履歴

### 2024年11月〜12月

| 日付 | 作業内容 |
|------|----------|
| 11月 | 初期構築開始、Cursor Rules作成 |
| 11月 | ブロックテーマ（FSE）で構築開始 |
| 11月 | クラシックテーマに変更（外注しやすさ重視） |
| 11月 | Figma MCP連携ルール追加 |
| 11月 | ワークフロードキュメント整備 |
| 12月 | テンプレート構造の整理（PROGRESS.md, DESIGN_NOTES.md追加） |
| 12月 | developブランチ作成、TEMPLATE_DEV.md追加 |

---

## ✅ 完了した整備

- [x] Cursor Rules 8ファイル作成
  - general.mdc
  - wordpress-theme.mdc
  - figma-integration.mdc
  - coding-standards.mdc
  - responsive-design.mdc
  - wordpress-advanced.mdc
  - quality-checklist.mdc
  - git-workflow.mdc
- [x] クラシックテーマへの移行
- [x] SCSS構造の整備（_variables.scss, _mixins.scss）
- [x] ワークフロードキュメント（QUICK_START.md, PROJECT_PLAN.md）
- [x] Docker Compose設定
- [x] 納品用ZIPスクリプト（create-delivery.sh）
- [x] 進捗管理テンプレート（PROGRESS.md）
- [x] デザインメモテンプレート（DESIGN_NOTES.md）
- [x] Figma MCP接続
- [x] ACF JSON自動同期設定（2024-12）
- [x] ハンバーガーメニューJS実装（2024-12）
- [x] SCSSディレクトリ構造（components/, sections/）（2024-12）
- [x] 基本SCSSファイル作成（2024-12）
  - _base.scss（リセット + 基本スタイル）
  - components/_button.scss
  - components/_card.scss
  - sections/_header.scss
  - sections/_footer.scss
- [x] Cursor最適化（2024-12）
  - general.mdc 更新（AIの役割明確化）
  - SCSSファイルにAI向けコメント追加
  - docs/PROMPTS.md 作成（コピペ用プロンプト集）

---

## 🔄 今後の改善TODO

### 優先度：高

- [ ] 実際の案件で使ってみて、足りないルールを追加
- [ ] 使いにくい部分があれば改善

### 優先度：中

- [ ] SCSS基礎ファイルのサンプルを充実させるか検討
- [ ] ACFフィールドのエクスポート/インポート手順を追加
- [ ] よくある実装パターンのスニペット集を作成

### 優先度：低

- [ ] 複数案件での使用実績を元にベストプラクティスを更新
- [ ] Figma MCPの新機能があれば対応

---

## 🚧 現在進行中の改善（2024-12）

> 実案件テストで見つかった課題への対応

### 📋 課題

**Figma MCP → PHP 直接生成がうまくいかない問題**

- 高性能モデルなら可能だが、トークンを大量消費
- Figma品質が悪い場合（DX→Figma変換など）は特に厳しい
- 一度に処理する情報が多すぎる

### 💡 解決策: 2段階アプローチ + ハイブリッド

```
【旧フロー】
Figma MCP → PHP + SCSS 直接生成（1段階）

【新フロー】
Figma MCP → JSON保存 → 品質チェック → HTML + SCSS → PHP（2段階）
```

### ✅ 今回のやることリスト

#### 1. ディレクトリ追加 ✅完了

- [x] `figma-data/` 作成（MCPデータ保存用）
  - [x] README.md（使い方説明）
  - [x] _template.md（MDテンプレート）
  - [x] images/（悪いFigma時の画像保存用）
- [x] `static-preview/` 作成（HTMLプレビュー用）
  - [x] README.md（使い方説明）
  - [x] index.html（サンプル）
  - [x] sections/_template.html（セクション用テンプレート）
  - [x] js/preview.js（jQuery使用）

#### 2. ワークフロー更新 ✅完了

- [x] 新しいフロー図をドキュメントに反映
- [x] セクション単位での実装フローを明確化
- [x] 「全セクションHTML化 → まとめてPHP化」のフローに変更

#### 3. ドキュメント更新 ✅完了

- [x] `docs/PROMPTS.md` に以下を追加：
  - [x] 品質チェック用プロンプト
  - [x] HTML生成用プロンプト（良いFigma用）
  - [x] HTML生成用プロンプト（悪いFigma用 = 画像 + 数値）
  - [x] PHP変換用プロンプト
- [x] `.cursor/rules/figma-integration.mdc` 更新
  - [x] 新フローの説明
  - [x] 品質チェック → 分岐の流れ
  - [x] AIの行動指針追加（品質チェック必須、PHP化はPhase3）
- [x] `.cursor/rules/general.mdc` 更新
  - [x] 標準フロー更新
  - [x] ディレクトリ構造更新
- [x] `docs/QUICK_START.md` 更新
  - [x] STEP 5/6の構成変更（HTML化 → PHP化）
- [x] `PROGRESS.md` 更新
  - [x] Phaseを新フローに合わせた
  - [x] 「新しいチャットを開いたら」セクション追加
  - [x] 表の列を「SCSS」「HTML」「PHP」「ACF」に分けた
  - [x] Phase 2の注意（AI向け）追加

#### 4. mainマージ ✅完了

- [x] 新しいディレクトリをmainに含める（サンプルファイル付き）
- [x] TEMPLATE_DEV.mdはmainに含めない（除外してマージ）

---

### 📝 変更履歴（2024-12 今回の作業）

| コミット | 内容 |
|----------|------|
| `331f21c` | 2段階アプローチ導入、ディレクトリ作成 |
| `7f87699` | 「全セクションHTML化→まとめてPHP化」に変更 |
| `acc1db5` | AIの行動指針追加（品質チェック必須、PHP化はPhase3） |
| (未push) | PROGRESS.md更新（新しいチャット用セクション追加）|

### 🔄 続きの作業をする場合

別のチャットで続きをする場合は、以下を伝える：

```
TEMPLATE_DEV.mdの「現在進行中の改善（2024-12）」を見て、
現在の状況を把握してください。

続きの作業: [具体的にやりたいこと]
```

### ❓ 残っている検討事項

- [ ] 実際の案件でこのフローを試して、問題があれば改善
- [ ] AIがルールを守らない場合のプロンプトの工夫
- [ ] PROGRESS.mdの使いやすさの確認

### 🔄 新ワークフロー詳細

**ポイント:** 全セクションをHTML化してから、まとめてPHP化する

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 【Phase 1】スタイルガイド → _variables.scss          ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                      │
                      ▼
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 【Phase 2】全セクションHTML化                        ┃
┃                                                     ┃
┃   以下を各セクションごとに繰り返し：                   ┃
┃   ┌─────────────────────────────────────────────┐  ┃
┃   │ 1. MCPでデータ取得 → JSON保存                │  ┃
┃   │ 2. 品質チェック → 良い/悪いを報告            │  ┃
┃   │ 3. 【良い】MD整理 / 【悪い】数値抽出+画像    │  ┃
┃   │ 4. SCSS作成 → ビルド                        │  ┃
┃   │ 5. HTML作成                                 │  ┃
┃   └─────────────────────────────────────────────┘  ┃
┃                                                     ┃
┃   → 全セクション完了後、ブラウザで全体確認・調整      ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                      │
                      ▼
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 【Phase 3】全セクションPHP化（まとめて実行）          ┃
┃                                                     ┃
┃   static-preview/sections/*.html                    ┃
┃       ↓                                             ┃
┃   wp-theme/template-parts/section-*.php             ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                      │
                      ▼
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 【Phase 4】ACF動的化                                ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

### メリット

- **作業の集中**: HTML作成 → PHP変換と同じ作業をまとめられる
- **全体確認**: HTML段階で全セクションの統一感を確認できる
- **クライアント確認**: 静的HTMLで全体を見せられる
- **PHP変換は機械的**: まとめて行った方が効率的

### 📁 追加するディレクトリ構造

```
figma-wordpress-project/
├── figma-data/              # 【新規】MCPデータ保存
│   ├── README.md            # 使い方説明
│   ├── _template.md         # MDテンプレート
│   ├── images/              # 悪いFigma時の画像保存
│   │   └── .gitkeep
│   ├── [section].json       # 生データ（案件時）
│   ├── [section].md         # 整理済み（案件時）
│   └── [section]-values.md  # 数値のみ（悪いFigma時）
│
├── static-preview/          # 【新規】HTMLプレビュー
│   ├── README.md            # 使い方説明
│   ├── index.html           # トップページプレビュー（サンプル）
│   ├── sections/            # セクション別HTML
│   │   └── _template.html   # セクション用テンプレート
│   ├── css/                 # ビルド済みCSSを配置
│   │   └── .gitkeep
│   ├── js/                  # プレビュー用JS
│   │   └── preview.js       # jQuery使用
│   └── images/              # プレビュー用画像
│       └── .gitkeep
│
├── wp-theme/                # 既存のまま
└── ...
```

### 📌 CSS方針

HTMLプレビュー時のCSS問題を解決するため、以下の方針で進める：

1. **SCSSを先に作成** → `wp-theme/assets/scss/sections/_[name].scss`
2. **ビルド** → `npm run build:css`
3. **プレビュー用にCSSをコピー** → `static-preview/css/style.css`
4. **HTMLで読み込み** → `<link rel="stylesheet" href="../css/style.css">`
5. **PHP化時** → SCSSはそのまま使える（二度手間なし）

### ❓ 検討事項（決定済み）

- `figma-data/` はmainに含めるか？
  → **含める**（README, _template.md, images/.gitkeep だけ残す）
- `static-preview/` はmainに含めるか？
  → **含める**（README, index.html, _template.html 等はサンプルとして残す）
- Git管理する/しないの判断
  → **Git管理する**（ユーザー希望）

---

## 🔍 テンプレート改善のための調査項目

> 実案件で使う前・使った後に、「どこを見直すか」を整理するためのメモ。

### 1. ワークフロー / ドキュメント

- [ ] `README.md` / `docs/QUICK_START.md` / `docs/PROJECT_PLAN.md` の役割分担が分かりやすいか
- [ ] 実際の作業フローとドキュメントの順番・粒度がズレていないか
- [ ] Figma MCP の使い方（Node ID取得〜依頼プロンプト）が十分具体的か / 冗長すぎないか
- [ ] 外注さん / 未来の自分が読んだときに「最初に何をすればいいか」がすぐ分かるか

### 2. テーマ構造（PHP / WordPress）

- [ ] `header.php` / `footer.php` / `front-page.php` / `page.php` などの役割が明確か
- [ ] `functions.php` と `inc/` 配下の責務分担（CPT, Taxonomy, ACF など）が整理されているか
- [ ] ループ処理・テンプレート階層・`get_template_part()` の使い方がサンプルとして適切か
- [ ] ACF 前提の書き方が「多すぎないか / 足りなすぎないか」（テンプレートとしてちょうど良いか）

### 3. SCSS設計 / レスポンシブ

- [ ] `_variables.scss` の構成（カラー・タイポグラフィ・スペーシング等）がFigmaのスタイルガイドと対応しやすいか
- [ ] `components/` と `sections/` の分け方・命名が直感的か
- [ ] レスポンシブルール（ブレークポイント・モバイルファースト方針）が `.cursor/rules/responsive-design.mdc` と矛盾していないか
- [ ] BEM記法のサンプルが十分かつ、複雑すぎて真似しづらくなっていないか

### 4. JavaScript / インタラクション

- [ ] `assets/js/main.js` の役割が明確か（ハンバーガーメニュー等の最低限のサンプルとして適切か）
- [ ] jQuery 前提で困るケースがないか、バニラJSにした方がテンプレートとして汎用的か
- [ ] Swiper.js など外部ライブラリを使う場合のサンプルコードや導入手順がどこまで必要か

### 5. Cursor Rules / AI連携

- [ ] `.cursor/rules/*.mdc` の内容と実際のテーマ構造がきちんと対応しているか
- [ ] AI に任せたい範囲・任せたくない範囲（要確認ポイント）が明確に書かれているか
- [ ] Figma MCP 利用ルール（「ファイル全体を渡さない」など）が重複しすぎていないか / 逆に埋もれていないか

### 6. 開発DX / 自動化

- [ ] `package.json` の npm script がシンプルかつ十分か（lint, format など追加した方がよいか）
- [ ] `docker-compose.yml` の設定が他案件でも流用しやすいか（DB名・ボリューム名など）
- [ ] `create-delivery.sh` の挙動が想定どおりか、案件ごとに変更しなくて良い設計になっているか

### 7. テンプレートとしての「空っぽ具合」

- [ ] サンプルのマークアップ / スタイル / CPT が「学習用の例」として役立ちつつ、案件ごとに邪魔になりすぎないか
- [ ] main ブランチに残すべき最低限のサンプルと、develop 専用にしておくべきものの切り分けが適切か
- [ ] 実案件コピー時に「消すべきもの」「残すべきもの」が README やコメントから一目で分かるか

---

## 💡 設計思想・判断メモ

### なぜクラシックテーマ？

- ブロックテーマ（FSE）より外注しやすい
- PHPの知識があれば誰でも編集できる
- ACFとの相性が良い

### なぜSCSS？

- 変数・mixin・ネストで効率的に書ける
- Figmaのデザイントークンと相性が良い
- npmでコンパイルできる（追加ツール不要）

### なぜjQuery？

- WordPress同梱版を使える
- 簡単なインタラクションには十分
- 外注先が理解しやすい

### Figma MCPの運用方針

- **絶対にファイル全体を渡さない**（トークン爆発防止）
- Node ID指定で必要な部分だけ取得
- スタイルガイド → セクションの2段階アプローチ

---

## 🗂️ ブランチ運用

```
main ─────────────────────────────
  │         ↑
  │         │ 整備完了後マージ
  │         │
  └── develop（テンプレート整備用）
            │
            └── このファイル（TEMPLATE_DEV.md）はここだけ
```

### mainブランチ

- コピーしてすぐ使える状態
- 空のテンプレートファイルを含む
- TEMPLATE_DEV.mdは含まない

### developブランチ

- テンプレート整備用
- 開発メモ（このファイル）を含む
- 整備が終わったらmainにマージ

---

## 📝 メモ

<!-- 自由にメモを書く場所 -->

